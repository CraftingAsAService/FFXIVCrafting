var gathering={init:function(){$(".collapse").click(gathering.collapse_row);$(".level_checkbox").click(gathering.toggle_levels);$(".job_checkbox").click(gathering.toggle_classes);$("#hide_shards").change(function(){$(".shard")[($(this).is(":checked")?"add":"remove")+"Class"]("hidden");$(".shard")[($(this).is(":checked")?"add":"remove")+"Class"]("shard-hidden");$(".and_more").popover("destroy");$(".and_more").popover();while($("#footer + .popover").length>0){$("#footer + .popover").remove()}});$(".and_more").popover();gathering_tour.init()},collapse_row:function(){var a=$(this);var b=a.closest("tr").next("tr");a.toggleClass("glyphicon-chevron-up").toggleClass("glyphicon-chevron-down");b.toggleClass("hidden")},toggle_levels:function(){var a=$(this);gathering[(a.is(":checked")?"show":"hide")+"_levels"](a);gathering.retally()},hide_levels:function(b){$("table.breakdown tbody tr."+b.attr("id")).each(function(){var e=$(this);var d=e.closest("table").find("tfoot");d.append(e)});var c=b.data("level");for(var a=c;a<=c+4;a++){$('td.amount_needed[data-level="'+a+'"]').each(function(){$(this).data("originalAdditional",$(this).data("additional")).data("additional",0);$(this).find("img").addClass("hidden")})}},show_levels:function(b){$("table.breakdown tfoot tr."+b.attr("id")).each(function(){var f=$(this);var d=f.closest("table").find("tbody");var e=false;if($("tr",d).length>0){$("tr",d).each(function(){var g=$(this);if(parseInt(f.data("level"))<g.data("level")){return}g.after(f);e=true})}if(e==false){d.prepend(f)}});var c=b.data("level");for(var a=c;a<=c+4;a++){$('td.amount_needed[data-level="'+a+'"]').each(function(){$(this).data("additional",$(this).data("originalAdditional"));$(this).find("img").removeClass("hidden")})}},toggle_classes:function(){var a=$(this);$("table.breakdown td."+a.attr("id"))[(a.is(":checked")?"remove":"add")+"Class"]("hidden");gathering.retally()},retally:function(){$("table.breakdown").each(function(){var e=$(this);var d=e.closest("tr").prev("tr");var b=0;e.find("tbody td:not(.hidden)").each(function(){var g=$(this).html();if(g!="-"){b+=parseInt(g)}});var a=d.find(".amount_needed");b+=parseInt(a.data("additional"));a.find("span").html(b.formatMoney(0,",",""));if(b==0){d.addClass("hidden").addClass("zero-hidden")}else{if(!d.hasClass("shard-hidden")&&d.hasClass("zero-hidden")){d.removeClass("hidden")}d.removeClass("zero-hidden")}var f=d.find(".total_cost");var c=parseInt(f.data("per"));if(c>0){f.find("span").html((b*c).formatMoney(0,",",""))}})}};$(gathering.init);Number.prototype.formatMoney=function(e,g,b){var f=this,e=isNaN(e=Math.abs(e))?2:e,b=b==undefined?".":b,g=g==undefined?",":g,a=f<0?"-":"",d=parseInt(f=Math.abs(+f||0).toFixed(e))+"",c=(c=d.length)>3?c%3:0;return a+(c?d.substr(0,c)+g:"")+d.substr(c).replace(/(\d{3})(?=\d)/g,"$1"+g)+(e?b+Math.abs(f-d).toFixed(e).slice(2):"")};