var gathering={init:function(){$(".collapse").click(gathering.collapse_row),$(".level_checkbox").click(gathering.toggle_levels),$(".job_checkbox").click(gathering.toggle_classes),$("#hide_shards").change((function(){for($(".shard")[($(this).is(":checked")?"add":"remove")+"Class"]("hidden"),$(".shard")[($(this).is(":checked")?"add":"remove")+"Class"]("shard-hidden"),$(".and_more").popover("destroy"),$(".and_more").popover();$("#footer + .popover").length>0;)$("#footer + .popover").remove()})),$("#hide_quests").change((function(){var e=$(this).is(":checked");$(".quest").each((function(){var a=$(".amount_needed",$(this)),t=$("img",a);t.hasClass("level-hidden")?t[(e?"add":"remove")+"Class"]("quest-hidden"):1==e?(a.data("originalAdditional",a.data("additional")).data("additional",0),t.addClass("hidden").addClass("quest-hidden")):(a.data("additional",a.data("originalAdditional")),t.removeClass("quest-hidden").removeClass("hidden"))})),gathering.retally()})),$(".and_more").popover()},collapse_row:function(){var e=$(this),a=e.closest("tr").next("tr");e.toggleClass("glyphicon-chevron-up").toggleClass("glyphicon-chevron-down"),a.toggleClass("hidden")},toggle_levels:function(){var e=$(this);gathering[(e.is(":checked")?"show":"hide")+"_levels"](e),gathering.retally()},hide_levels:function(e){$("table.breakdown tbody tr."+e.attr("id")).each((function(){var e=$(this);e.closest("table").find("tfoot").append(e)}));for(var a=e.data("level"),t=a;t<=a+4;t++)$('td.amount_needed[data-level="'+t+'"]').each((function(){$(this).data("originalAdditional",$(this).data("additional")).data("additional",0),$(this).find("img").addClass("hidden").addClass("level-hidden")}))},show_levels:function(e){$("table.breakdown tfoot tr."+e.attr("id")).each((function(){var e=$(this),a=e.closest("table").find("tbody"),t=!1;$("tr",a).length>0&&$("tr",a).each((function(){var a=$(this);parseInt(e.data("level"))<a.data("level")||(a.after(e),t=!0)})),0==t&&a.prepend(e)}));for(var a=e.data("level"),t=a;t<=a+4;t++)$('td.amount_needed[data-level="'+t+'"]').each((function(){$(this).data("additional",$(this).data("originalAdditional"));var e=$(this).find("img");e.removeClass("level-hidden"),e.hasClass("quest-hidden")||e.removeClass("hidden")}))},toggle_classes:function(){var e=$(this);$("table.breakdown td."+e.attr("id"))[(e.is(":checked")?"remove":"add")+"Class"]("hidden"),gathering.retally()},retally:function(){$("table.breakdown").each((function(){var e=$(this),a=e.closest("tr").prev("tr"),t=0;e.find("tbody td:not(.hidden)").each((function(){var e=$(this).html();"-"!=e&&(t+=parseInt(e))}));var d=a.find(".amount_needed");t+=parseInt(d.data("additional")),d.find("span").html(t.formatMoney(0,",","")),0==t?a.addClass("hidden").addClass("zero-hidden"):(!a.hasClass("shard-hidden")&&a.hasClass("zero-hidden")&&a.removeClass("hidden"),a.removeClass("zero-hidden"));var i=a.find(".total_cost"),n=parseInt(i.data("per"));n>0&&i.find("span").html((t*n).formatMoney(0,",",""))}))}};$(gathering.init),Number.prototype.formatMoney=function(e,a,t){var d=this,i=(e=isNaN(e=Math.abs(e))?2:e,t=null==t?".":t,a=null==a?",":a,d<0?"-":""),n=parseInt(d=Math.abs(+d||0).toFixed(e))+"",s=(s=n.length)>3?s%3:0;return i+(s?n.substr(0,s)+a:"")+n.substr(s).replace(/(\d{3})(?=\d)/g,"$1"+a)+(e?t+Math.abs(d-n).toFixed(e).slice(2):"")};