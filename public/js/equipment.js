function unique(e){return $.grep(e,function(t,a){return a==$.inArray(t,e)})}var equipment={options:{job:job,level:level,craftable_only:craftable_only,rewardable_too:rewardable_too,level_range:3,viewport_differential:0,boring_stats:!1},init:function(){$(".bootswitch").bootstrapSwitch({onSwitchChange:function(){$(this).closest("form").submit()}}),$.fn.inlineStyle=function(e){return this.prop("style")[$.camelCase(e)]},$(document).on("viewportchanged",equipment.viewport_changed),equipment.viewport_changed(),equipment.table_events(),equipment.page_events(),equipment_tour.init()},viewport_changed:function(){equipment.slim($("#toggle-slim").bootstrapSwitch("state"))},cell_events:function(){equipment.mark_upgrades(),equipment.same_cell_heights(),global.trigger_xivdb_tooltips(),$("#gear tbody td:visible .td-navigation .item-next").on("click",function(e){e.preventDefault();var t=$(this).closest("td");t.trigger("mouseleave");var a=t.find(".items"),i=a.find(".item.active"),n=i.next();1!=n.length&&(n=a.children(":first-child")),i.removeClass("active").addClass("hidden"),n.removeClass("hidden").addClass("active"),t.trigger("mouseenter");var o=parseInt(t.find(".td-navigation .total").html()),s=t.find(".td-navigation .current"),l=parseInt(s.html());l++,l>o&&(l=1),s.html(l),equipment.mark_cannot_equips(),equipment.stat_summary(t),$("#gear td:visible .role-wrap").css("height","inherit"),equipment.same_cell_heights()}),$("#gear tbody td:visible").on("mouseenter",equipment.compare),$("#gear tbody td:visible").on("mouseleave",equipment.uncompare),$("[rel=tooltip]").tooltip(global.tooltip_options),$("#gear tbody tr:first-child td:visible").each(function(){equipment.stat_summary($(this))})},table_events:function(){equipment.cell_events(),$(".previous-gear").click(function(){if(!$(this).hasClass("disabled")){$(".previous-gear, .next-gear").addClass("disabled");var e=equipment.options.level-1;if(e<1)return void $(".previous-gear, .next-gear").removeClass("disabled");equipment.options.level=e,$("td[data-level="+e+"]").length>0?(equipment.column_display(),equipment.fix_rows(),equipment.mark_upgrades(),equipment.same_cell_heights(),e-1>0&&0==$("td[data-level="+(e-1)+"]").length?equipment.load_column(e-1,"Pre"):$(".previous-gear, .next-gear").removeClass("disabled")):equipment.load_column(e)}}),$(".next-gear").click(function(){if(!$(this).hasClass("disabled")){$(".previous-gear, .next-gear").addClass("disabled");var e=equipment.options.level+1;if(e>max_level-2)return void $(".previous-gear, .next-gear").removeClass("disabled");equipment.options.level=e,$("td[data-level="+(e+equipment.options.level_range-1)+"]").length>0?(equipment.column_display(),equipment.fix_rows(),equipment.mark_upgrades(),equipment.same_cell_heights(),e+equipment.options.level_range<=max_level&&0==$("td[data-level="+(e+equipment.options.level_range-1)+"]").length?equipment.load_column(e+equipment.options.level_range-1,"Pre"):$(".previous-gear, .next-gear").removeClass("disabled")):equipment.load_column(e+equipment.options.level_range-1)}})},slim:function(e){$("#gear")[(e?"add":"remove")+"Class"]("slim"),$("td:visible .role-wrap").css("height","inherit"),equipment.options.level_range=e?4:3,equipment.options.viewport_differential="mobile"==viewport.current?3-(e?0:1):0,equipment.column_display(),equipment.same_cell_heights()},same_cell_heights:function(){$("#gear tbody tr").each(function(){var e=$(this),t=0;$("td:visible .role-wrap",e).each(function(){var e=$(this),a=0;""!=$(this).inlineStyle("height")&&(a=16);var i=e.innerHeight()-a;i>t&&(t=i)}),$("td:visible .role-wrap",e).height(t)})},mark_upgrades:function(){$("#gear tbody td:visible").each(function(){var e=$(this),t=e.data("level"),a=e.closest("tr").find("td[data-level="+(t-1)+"]");if(0!=a.length||1==t){e[(e.find(".item:first-child").data("itemIlvl")==a.find(".item:first-child").data("itemIlvl")?"remove":"add")+"Class"]("upgrade")}}),equipment.mark_cannot_equips()},mark_cannot_equips:function(){$("#gear tbody td.cannot-equip").removeClass("cannot-equip"),$(".why-cannot-equip").remove(),$('#gear tbody td:visible .item.active:not([data-cannot-equip=""])').each(function(){for(var e=$(this),t=$(".name-box a",e).html(),a=$.isNumeric(e.data("cannotEquip"))?[]:e.data("cannotEquip").split(","),i=e.closest("td"),n=i.data("level"),o=0;o<a.length;o++){var s=$(".role-"+a[o].capitalize().replace(/ /,"-")+"[data-level="+n+"]");s.append('<div class="why-cannot-equip">'+t+"<br>Cannot equip gear to "+a[o].capitalize()+"</div>"),s.addClass("cannot-equip")}equipment.stat_summary(i)})},load_column:function(e,t){if(void 0===t&&(t=""),"mobile"==viewport.current&&(t="Pre"),parseInt(e)>max_level)return void $(".previous-gear, .next-gear").removeClass("disabled");$.ajax({url:"/equipment/load",type:"post",dataType:"json",data:{job:equipment.options.job,level:e,craftable_only:equipment.options.craftable_only,rewardable_too:equipment.options.rewardable_too},beforeSend:function(){global.noty({type:"warning",text:t+"Loading Level "+e})},success:function(t){$.each(t.gear,function(t,a){$('#gear .role-row[data-role="'+t+'"]').append(a[e])}),$("#gear thead tr").append(t.head[e]),$("#gear tfoot tr").append(t.foot[e]),equipment.column_display(),equipment.fix_rows(),equipment.cell_events(),$(".previous-gear, .next-gear").removeClass("disabled")}})},fix_rows:function(){$("#gear tr").each(function(){var e=$(this),t=e.find("th:visible, td:visible").get();t.sort(function(e,t){var a=parseInt($(e).data("level")),i=parseInt($(t).data("level"));return i>a?-1:i<a?1:0});for(var a=0;a<t.length;a++)t[a].parentNode.appendChild(t[a])})},column_display:function(e){var t=equipment.options.level;t>max_level-equipment.options.level_range+1&&(t=max_level-equipment.options.level_range+1),$("#gear td[data-level]").addClass("hidden"),$("#gear th[data-level]").addClass("hidden");for(var a=t;a<equipment.options.level+equipment.options.level_range-equipment.options.viewport_differential;a++)$("#gear td[data-level="+a+"]").removeClass("hidden"),$("#gear th[data-level="+a+"]").removeClass("hidden")},compare:function(){var e=$(this),t=e.find(".item.active .stats-box"),a=e.prev("td").find(".item.active .stats-box");t.find(".stat").each(function(){var e=$(this),t=a.find('.stat[data-stat="'+e.data("stat")+'"]');if(0==t.length)$("span",e).html(e.data("amount")).addClass("text-success");else{var i=parseInt(e.data("amount"))-parseInt(t.data("amount"));$("span",e).html(i).addClass("text-"+(i>0?"success":i<0?"danger":"warning"))}})},uncompare:function(){$(this).find(".stats-box .stat").each(function(){var e=$(this);$("span",e).html(e.data("amount")).removeClass("text-success").removeClass("text-danger").removeClass("text-warning")})},stat_summary:function(e){var t=$(e).data("level"),a=[],i=[];$("#gear tbody tr td[data-level="+t+']:not("cannot-equip")').each(function(){$(this).find(".item.active .nq.stat").each(function(){var e=$(this),t=e.data();e.hasClass("hidden")&&(i[i.length]=t.statImage),void 0===a[t.statImage]&&(a[t.statImage]=0),a[t.statImage]+=t.amount})});var n=$("#gear tfoot tr:first-child th[data-level="+t+"] .stats-box");n.html("");for(var o in a){var s=a[o],l=$("<div>");i.indexOf(o)>-1&&l.addClass("hidden"),l.addClass("col-sm-6").addClass("text-center").addClass("stat").attr("data-stat",o).attr("data-amount",s);var r=$("<span>");r.html("+"+s+" &nbsp; ");var d=$("<img>");d.attr("src","/img/stats/"+o+".png").addClass("stat-icon").attr("rel","tooltip").attr("title",o),l.append(r),l.append(d),n.append(l)}},all_stats:function(){$("#gear td:visible .stats-box .boring").toggleClass("hidden"),$("#gear td:visible .role-wrap").css("height","inherit"),equipment.same_cell_heights()},page_events:function(){$("#toggle-slim").on("switchChange.bootstrapSwitch",function(e,t){equipment.slim(t),$("html, body").animate({scrollTop:$("#table-options").offset().top},"slow")}),$("#toggle-slim").bootstrapSwitch("state")&&(equipment.options.level_range=4),$("#toggle-all-stats").on("switchChange.bootstrapSwitch",function(e,t){equipment.options.boring_stats=t,equipment.all_stats(),$("html, body").animate({scrollTop:$("#table-options").offset().top},"slow")})}},equipment_tour={tour:null,first_run:!0,init:function(){var e=$("#start_tour");equipment_tour.tour=new Tour({orphan:!0,onStart:function(){return e.addClass("disabled",!0)},onEnd:function(){return e.removeClass("disabled",!0)}}),e.click(function(e){e.preventDefault(),$("#toggle-slim").bootstrapSwitch("state")&&$("#toggle-slim").bootstrapSwitch("toggleState"),1==equipment_tour.first_run&&equipment_tour.build(),$(this).hasClass("disabled")||equipment_tour.tour.restart()})},build:function(){var e=$("#gear td:visible.upgrade")[0],t=$(".item.active .stats-box .stat",e)[0],a=$("#gear td:visible .item.active .crafted_by")[0];equipment_tour.tour.addSteps([{element:e,title:"Upgrade",content:"Boxes with a border and circle icon indicate an upgrade."},{element:t,title:"Stats",content:"These are the stats for the item.  Hovering on them will tell you how much of an upgrade it is from the previous item.",placement:"bottom"},{element:a,title:"Crafted By & Buyable",content:"<p>This item can be crafted by the class indicated. <strong>Clicking on it will add that item to your Crafting Cart!</strong></p><p>The coins indicate that you can buy them from a vendor.</p>"},{element:".previous-gear",title:"Level Traversing",content:"Click this bar (and the one on the right) to decrease (or increase) the gear level."},{element:"#toggle-slim",title:"Slim Mode",content:"If you don't want to see stats, turn this mode on.",placement:"top"},{element:"#toggle-all-stats",title:"Boring Stats",content:"Boring stats are hidden by default.  Use this option to turn them on.  An example of a boring stat would be Magic Damage to a Disciple of War class.",placement:"top"}]),equipment_tour.first_run=!1}};$(equipment.init);