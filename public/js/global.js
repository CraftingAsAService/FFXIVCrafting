var global={tooltip_options:{container:"body"},init:function(){global.detect_systems(),global.hide_me(),global.add_token_to_ajax_calls(),$("[rel=tooltip]").tooltip(global.tooltip_options),global.reset_popovers(),$("#buymeabeer").click(function(t){t.preventDefault(),$("#buymeabeer_button").trigger("click")}),$(document).on("click",".add-to-list",function(){var t=$(this),o=t.data("itemId"),e=t.data("itemName");qty=t.data("itemQuantity"),$.ajax({url:"/list/add",type:"post",data:{"item-id":o,qty:qty},beforeSend:function(){global.noty({type:"success",text:"Adding "+(qty>1?qty+" x ":"")+e+" to your list"}),t.hasClass("success-after-add")&&(t.removeClass("btn-default").addClass("btn-success"),t.find(".glyphicon-plus").removeClass("glyphicon-plus").addClass("glyphicon-ok"))}})}),$(document).on("click",".click-to-view",global.click_to_view),$(document).on("click",".isearch",global.isearch),$(".toggle-mobile-nav").click(function(){$("body").toggleClass("mobile-nav-enabled")}),0==localStorage.getItem("config:self_sufficient")&&$(".fix-self-sufficient").each(function(){var t=$(this);t.attr("href",t.attr("href").replace(/(\?|\&)self_sufficient=1/,""))})},hide_me:function(){$(".hide-me").each(function(){var t=$(this);if("true"!==localStorage.getItem("config:"+t.data("storage"))){var o=t;""!=t.data("target")&&(o=$(t.data("target"))),o.removeClass("hidden")}}),$(".hide-me").click(function(t){t.preventDefault();var o=$(this);localStorage.setItem("config:"+o.data("storage"),"true");var e=o;""!=o.data("target")&&(e=$(o.data("target"))),e.addClass("hidden")})},add_token_to_ajax_calls:function(){var t=$('meta[name="csrf-token"]').attr("content");$.ajaxPrefilter(function(o,e,a){"post"===o.type.toLowerCase()&&(o.data+=o.data?"&":"",o.data+="_token="+t)})},visible_popover:null,reset_popovers:function(t){$("[data-toggle=popover][data-content-id]").each(function(){$(this).data("content",$($(this).data("contentId")).html()),$($(this).data("contentId")).remove()});var o=$("[data-toggle=popover]");o.popover({container:"body",html:"true"}),o.on("click",function(t){t.stopPropagation();var o=$(this);null!==global.visible_popover&&global.visible_popover.data("contentId")==o.data("contentId")?(global.visible_popover=null,o.popover("hide")):(null!==global.visible_popover&&global.visible_popover.popover("hide"),global.visible_popover=o,o.popover("show"),$("[rel=tooltip]",o).tooltip(global.tooltip_options))}),$(document).click(function(t){0==$(t.target).closest(".popover").length&&"popover"!=$(t.target).data("toggle")&&(null!==global.visible_popover&&global.visible_popover.trigger("click"),global.visible_popover=null,o.popover("hide"))})},noty:function(t){noty({text:t.text,type:t.type,layout:"bottomCenter",timeout:2500})},notification:function(t,o,e){$("#notifications").append('<div class="alert alert-'+t+'" id="'+e+'">'+o)},fade_and_destroy:function(t){t.fadeOut(500,function(){t.remove()})},get_cookie:function(t){t+="=";for(var o=document.cookie.split(";"),e=0;e<o.length;e++){for(var a=o[e];" "==a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t))return a.substring(t.length,a.length)}return null},set_cookie:function(t,o){var e=new Date;return e.setDate(e.getDate()+365),o=escape(o)+"; expires="+e.toUTCString()+";path=/",document.cookie=t+"="+o,!0},exportToCsv:function(t,o){for(var e="",a=0;a<o.length;a++)e+=function(t){for(var o="",e=0;e<t.length;e++){var a=null===t[e]?"":t[e].toString(),i=a.replace(/"/g,'""');i.search(/("|,|\n)/g)>=0&&(i='"'+i+'"'),e>0&&(o+=","),o+=i}return o+"\n"}(o[a]);var i=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(i,t);else{var n=document.createElement("a");if(void 0!==n.download){var l=URL.createObjectURL(i);n.setAttribute("href",l),n.setAttribute("download",t),n.style="visibility:hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}},detect_systems:function(){var t,o=navigator.appName,e=navigator.userAgent,a=e.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);a&&null!=(t=e.match(/version\/([\.\d]+)/i))&&(a[2]=t[1]),a=a?[a[1],a[2]]:[o,navigator.appVersion,"-?"],$("body").addClass(a[0]),"MSIE"==a[0]&&$("body").addClass("msie"+parseFloat(a[1])),navigator.platform.toUpperCase().indexOf("WIN")>=0&&$("body").addClass("Windows"),navigator.platform.toUpperCase().indexOf("MAC")>=0&&$("body").addClass("Mac"),navigator.platform.toUpperCase().indexOf("LINUX")>=0&&$("body").addClass("Linux"),navigator.platform.match(/(iPhone|iPod|iPad|Pike)/i)&&$("body").addClass("IOS"),navigator.platform.match(/Android/i)&&$("body").addClass("Android"),global.is_handheld_device=navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i),$("body").addClass(global.is_handheld_device?"is_handheld":"not_handheld"),navigator.userAgent.match(/Trident.*rv[ :]*11\./)&&$("body").addClass("msie11")},isearch:function(t){t.preventDefault();var o=$(this),e=o.data("clipboard");console.log(e),navigator.clipboard.writeText(e).then(function(){global.noty({type:"success",text:"Item name copied to clipboard!"})},function(){global.noty({type:"error",text:"Could not access clipboard :("})})},click_to_view:function(t){t.preventDefault();var o=$(this),e=o.data("type"),a=o.closest("[data-item-id]").data("itemId");if(!o.hasClass("loading")){if($("#"+e+"-for-"+a).length>0)return $("#"+e+"-for-"+a).modal("show");$.ajax({url:"/entity/"+a+"/"+e,dataType:"html",beforeSend:function(){o.addClass("loading"),global.noty({type:"warning",text:"Loading "+e.substring(0,1).toUpperCase()+e.substring(1)})},success:function(t){$("body").append(t),$("#"+e+"-for-"+a).modal(),o.removeClass("loading")}})}}};$(global.init),$(function(){var t=$.fn.popover.Constructor.prototype.show;$.fn.popover.Constructor.prototype.show=function(){var o=$("<div>").html('<div class="popover tour-tour">          <div class="arrow"></div>          <h3 class="popover-title"></h3>          <div class="popover-content"></div>          <nav class="popover-navigation">            <div class="btn-group">              <button class="btn btn-sm btn-default disabled" data-role="prev">« Prev</button>              <button class="btn btn-sm btn-default" data-role="next">Next »</button>            </div>            <button class="btn btn-sm btn-default" data-role="end">End tour</button>          </nav>        </div>');o.find("h3").before('<img src="/img/tour_moogle.png" class="tour_moogle">'),this.options.template=o.html(),t.call(this)}}),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};