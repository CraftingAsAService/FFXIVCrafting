var global={init:function(){global.detect_systems(),global.add_token_to_ajax_calls(),$("[rel=tooltip]").tooltip({container:"body"}),global.reset_popovers(),$("#buymeabeer").click(function(a){a.preventDefault(),$("#buymeabeer_button").trigger("click")}),$(document).on("click",".add-to-list",function(){var a=$(this),b=a.data("itemId"),c=a.data("itemName");qty=a.data("itemQuantity"),$.ajax({url:"/list/add",type:"post",data:{"item-id":b,qty:qty},beforeSend:function(){global.noty({type:"success",text:"Adding "+(qty>1?qty+" x ":"")+c+" to your list"}),a.hasClass("success-after-add")&&(a.removeClass("btn-default").addClass("btn-success"),a.find(".glyphicon-plus").removeClass("glyphicon-plus").addClass("glyphicon-ok"))}})}),$(document).on("click",".click-to-view",global.click_to_view),$(".toggle-mobile-nav").click(function(){$("body").toggleClass("mobile-nav-enabled")})},add_token_to_ajax_calls:function(){var a=$('meta[name="csrf-token"]').attr("content");$.ajaxPrefilter(function(b){"post"===b.type.toLowerCase()&&(b.data+=b.data?"&":"",b.data+="_token="+a)})},visible_popover:null,reset_popovers:function(){$("[data-toggle=popover][data-content-id]").each(function(){$(this).data("content",$($(this).data("contentId")).html()),$($(this).data("contentId")).remove()});var a=$("[data-toggle=popover]");a.popover({container:"body",html:"true"}),a.on("click",function(a){a.stopPropagation();var b=$(this);null!==global.visible_popover&&global.visible_popover.data("contentId")==b.data("contentId")?(global.visible_popover=null,b.popover("hide")):(null!==global.visible_popover&&global.visible_popover.popover("hide"),global.visible_popover=b,b.popover("show"),$("[rel=tooltip]",b).tooltip())}),$(document).click(function(b){0==$(b.target).closest(".popover").length&&"popover"!=$(b.target).data("toggle")&&(null!==global.visible_popover&&global.visible_popover.trigger("click"),global.visible_popover=null,a.popover("hide"))})},noty:function(a){noty({text:a.text,type:a.type,layout:"bottomCenter",timeout:2500})},notification:function(a,b,c){$("#notifications").append('<div class="alert alert-'+a+'" id="'+c+'">'+b)},fade_and_destroy:function(a){a.fadeOut(500,function(){a.remove()})},get_cookie:function(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a))return d.substring(a.length,d.length)}return null},set_cookie:function(a,b){var c=new Date;return c.setDate(c.getDate()+365),b=escape(b)+"; expires="+c.toUTCString()+";path=/",document.cookie=a+"="+b,!0},exportToCsv:function(a,b){for(var c=function(a){for(var b="",c=0;c<a.length;c++){var d=null===a[c]?"":a[c].toString(),e=d.replace(/"/g,'""');e.search(/("|,|\n)/g)>=0&&(e='"'+e+'"'),c>0&&(b+=","),b+=e}return b+"\n"},d="",e=0;e<b.length;e++)d+=c(b[e]);var f=new Blob([d],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(f,a);else{var g=document.createElement("a");if(void 0!==g.download){var h=URL.createObjectURL(f);g.setAttribute("href",h),g.setAttribute("download",a),g.style="visibility:hidden",document.body.appendChild(g),g.click(),document.body.removeChild(g)}}},detect_systems:function(){var a,b=navigator.appName,c=navigator.userAgent,d=c.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);d&&null!=(a=c.match(/version\/([\.\d]+)/i))&&(d[2]=a[1]),d=d?[d[1],d[2]]:[b,navigator.appVersion,"-?"],$("body").addClass(d[0]),"MSIE"==d[0]&&$("body").addClass("msie"+parseFloat(d[1])),navigator.platform.toUpperCase().indexOf("WIN")>=0&&$("body").addClass("Windows"),navigator.platform.toUpperCase().indexOf("MAC")>=0&&$("body").addClass("Mac"),navigator.platform.toUpperCase().indexOf("LINUX")>=0&&$("body").addClass("Linux"),navigator.platform.match(/(iPhone|iPod|iPad|Pike)/i)&&$("body").addClass("IOS"),navigator.platform.match(/Android/i)&&$("body").addClass("Android"),global.is_handheld_device=navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i),$("body").addClass(global.is_handheld_device?"is_handheld":"not_handheld"),navigator.userAgent.match(/Trident.*rv[ :]*11\./)&&$("body").addClass("msie11")},click_to_view:function(){var a=$(this),b=a.data("type"),c=a.closest("[data-item-id]").data("itemId");if(!a.hasClass("loading")){var d=$("#"+b+"-for-"+c);return d.length>0?$("#"+b+"-for-"+c).modal("show"):void $.ajax({url:"/entity/"+c+"/"+b,dataType:"html",beforeSend:function(){a.addClass("loading"),global.noty({type:"warning",text:"Loading "+b.substring(0,1).toUpperCase()+b.substring(1)})},success:function(d){$("body").append(d),$("#"+b+"-for-"+c).modal(),a.removeClass("loading")}})}}};$(global.init),$(function(){var a=$.fn.popover.Constructor.prototype.show;$.fn.popover.Constructor.prototype.show=function(){var b=$("<div>").html('<div class="popover tour-tour">          <div class="arrow"></div>          <h3 class="popover-title"></h3>          <div class="popover-content"></div>          <nav class="popover-navigation">            <div class="btn-group">              <button class="btn btn-sm btn-default disabled" data-role="prev">« Prev</button>              <button class="btn btn-sm btn-default" data-role="next">Next »</button>            </div>            <button class="btn btn-sm btn-default" data-role="end">End tour</button>          </nav>        </div>');b.find("h3").before('<img src="/img/tour_moogle.png" class="tour_moogle">'),this.options.template=b.html(),a.call(this)}}),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};