!function(t){"use strict";function e(e,i){this.options=this.getOptions(i),this.$select=t(e),this.originalOptions=this.$select.clone()[0].options,this.query="",this.searchTimeout=null,this.options.multiple="multiple"==this.$select.attr("multiple"),this.$container=t(this.options.buttonContainer).append('<button type="button" class="multiselect dropdown-toggle '+this.options.buttonClass+'" data-toggle="dropdown">'+this.options.buttonText(this.getSelected(),this.$select)+"</button>").append('<ul class="multiselect-container dropdown-menu'+(this.options.dropRight?" pull-right":"")+'"></ul>'),this.options.buttonWidth&&t("button",this.$container).css({width:this.options.buttonWidth});var s=this.$select.attr("tabindex");if(s&&t("button",this.$container).attr("tabindex",s),this.options.maxHeight&&t(".multiselect-container",this.$container).css({"max-height":this.options.maxHeight+"px","overflow-y":"auto","overflow-x":"hidden"}),this.options.enableFiltering||this.options.enableCaseInsensitiveFiltering){var n=Math.max(this.options.enableFiltering,this.options.enableCaseInsensitiveFiltering);this.$select.find("option").length>=n&&this.buildFilter()}this.buildSelectAll(),this.buildDropdown(),this.updateButtonText(),this.$select.hide().after(this.$container)}"undefined"!=typeof ko&&ko.bindingHandlers&&!ko.bindingHandlers.multiselect&&(ko.bindingHandlers.multiselect={init:function(t,e,i,s,n){},update:function(e,i,s,n,l){var o=t(e).data("multiselect");o?s().options&&s().options().length!==o.originalOptions.length&&(o.updateOriginalOptions(),t(e).multiselect("rebuild")):t(e).multiselect(ko.utils.unwrapObservable(i()))}}),e.prototype={defaults:{buttonText:function(e,i){if(0==e.length)return this.nonSelectedText+' <b class="caret"></b>';if(e.length>3)return e.length+" "+this.nSelectedText+' <b class="caret"></b>';var s="";return e.each((function(){var e=void 0!==t(this).attr("label")?t(this).attr("label"):t(this).html();s+=e+", "})),s.substr(0,s.length-2)+' <b class="caret"></b>'},buttonTitle:function(e,i){var s="";return e.each((function(){s+=t(this).text()+", "})),s.substr(0,s.length-2)},onChange:function(t,e){},buttonClass:"btn",dropRight:!1,selectedClass:"active",buttonWidth:"auto",buttonContainer:'<div class="btn-group" />',maxHeight:!1,includeSelectAllOption:!1,selectAllText:" Select all",selectAllValue:"multiselect-all",enableFiltering:!1,enableCaseInsensitiveFiltering:!1,filterPlaceholder:"Search",filterBehavior:"text",preventInputChangeEvent:!1,nonSelectedText:"None selected",nSelectedText:"selected"},constructor:e,createOptionValue:function(e){t(e).is(":selected")&&t(e).attr("selected","selected").prop("selected",!0);var i=t(e).attr("label")||t(e).html(),s=t(e).val(),n=this.options.multiple?"checkbox":"radio",l=t('<li><a href="javascript:void(0);"><label class="'+n+'"><input type="'+n+'" /></label></a></li>'),o=t(e).prop("selected")||!1,a=t("input",l);a.val(s),s==this.options.selectAllValue&&a.parent().parent().addClass("multiselect-all"),t("label",l).append(" "+i),t(".multiselect-container",this.$container).append(l),t(e).is(":disabled")&&a.attr("disabled","disabled").prop("disabled",!0).parents("li").addClass("disabled"),a.prop("checked",o),o&&this.options.selectedClass&&a.parents("li").addClass(this.options.selectedClass)},createOptgroup:function(e){var i=t(e).prop("label"),s=t('<li><label class="multiselect-group"></label></li>');t("label",s).text(i),t(".multiselect-container",this.$container).append(s),t("option",e).each(t.proxy((function(t,e){this.createOptionValue(e)}),this))},toggleActiveState:function(){null==this.$select.attr("disabled")?t("button.multiselect.dropdown-toggle",this.$container).removeClass("disabled"):t("button.multiselect.dropdown-toggle",this.$container).addClass("disabled")},buildSelectAll:function(){var t=!!this.$select[0][0]&&this.$select[0][0].value==this.options.selectAllValue;this.options.includeSelectAllOption&&this.options.multiple&&!t&&this.$select.prepend('<option value="'+this.options.selectAllValue+'">'+this.options.selectAllText+"</option>")},buildDropdown:function(){this.toggleActiveState(),this.$select.children().each(t.proxy((function(e,i){var s=t(i).prop("tagName").toLowerCase();"optgroup"==s?this.createOptgroup(i):"option"==s&&this.createOptionValue(i)}),this)),t(".multiselect-container li input",this.$container).on("change",t.proxy((function(e){var i=t(e.target).prop("checked")||!1,s=t(e.target).val()==this.options.selectAllValue;this.options.selectedClass&&(i?t(e.target).parents("li").addClass(this.options.selectedClass):t(e.target).parents("li").removeClass(this.options.selectedClass));var n=t("option",this.$select).filter((function(){return t(this).val()==t(e.target).val()})),l=t("option",this.$select).not(n),o=t("input",this.$container).not(t(e.target));if(s&&o.filter((function(){return t(this).is(":checked")!=i})).trigger("click"),i?(n.prop("selected",!0),this.options.multiple?n.attr("selected","selected"):(this.options.selectedClass&&t(o).parents("li").removeClass(this.options.selectedClass),t(o).prop("checked",!1),l.removeAttr("selected").prop("selected",!1),t(this.$container).find(".multiselect.dropdown-toggle").click()),"active"==this.options.selectedClass&&l.parents("a").css("outline","")):n.removeAttr("selected").prop("selected",!1),this.updateButtonText(),this.options.onChange(n,i),this.$select.change(),this.options.preventInputChangeEvent)return!1}),this)),t(".multiselect-container li a",this.$container).on("touchstart click",(function(e){e.stopPropagation(),t(e.target).blur()})),this.$container.on("keydown",t.proxy((function(e){if(!t('input[type="text"]',this.$container).is(":focus"))if(9!=e.keyCode&&27!=e.keyCode||!this.$container.hasClass("open")){var i=t(this.$container).find("li:not(.divider):visible a");if(!i.length)return;var s=i.index(i.filter(":focus"));38==e.keyCode&&s>0?s--:40==e.keyCode&&s<i.length-1?s++:~s||(s=0);var n=i.eq(s);if(n.focus(),"active"==this.options.selectedClass&&(n.css("outline","thin dotted #333").css("outline","5px auto -webkit-focus-ring-color"),i.not(n).css("outline","")),32==e.keyCode||13==e.keyCode){var l=n.find("input");l.prop("checked",!l.prop("checked")),l.change()}e.stopPropagation(),e.preventDefault()}else t(this.$container).find(".multiselect.dropdown-toggle").click()}),this))},buildFilter:function(){t(".multiselect-container",this.$container).prepend('<div class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span><input class="form-control multiselect-search" type="text" placeholder="'+this.options.filterPlaceholder+'"></div>'),t(".multiselect-search",this.$container).val(this.query).on("click",(function(t){t.stopPropagation()})).on("keydown",t.proxy((function(e){clearTimeout(this.searchTimeout),this.searchTimeout=this.asyncFunction(t.proxy((function(){this.query!=e.target.value&&(this.query=e.target.value,t.each(t(".multiselect-container li",this.$container),t.proxy((function(e,i){if((s=t("input",i).val())!=this.options.selectAllValue){var s,n=t("label",i).text();if((s=t("input",i).val())&&n&&s!=this.options.selectAllValue){var l=!1,o="";"text"!=this.options.filterBehavior&&"both"!=this.options.filterBehavior||(o=n),"value"!=this.options.filterBehavior&&"both"!=this.options.filterBehavior||(o=s),(this.options.enableCaseInsensitiveFiltering&&o.toLowerCase().indexOf(this.query.toLowerCase())>-1||o.indexOf(this.query)>-1)&&(l=!0),l?t(i).show():t(i).hide()}}}),this)))}),this),300,this)}),this))},destroy:function(){this.$container.remove(),this.$select.show()},refresh:function(){t("option",this.$select).each(t.proxy((function(e,i){var s=t(".multiselect-container li input",this.$container).filter((function(){return t(this).val()==t(i).val()}));t(i).is(":selected")?(s.prop("checked",!0),this.options.selectedClass&&s.parents("li").addClass(this.options.selectedClass)):(s.prop("checked",!1),this.options.selectedClass&&s.parents("li").removeClass(this.options.selectedClass)),t(i).is(":disabled")?s.attr("disabled","disabled").prop("disabled",!0).parents("li").addClass("disabled"):s.removeAttr("disabled").prop("disabled",!1).parents("li").removeClass("disabled")}),this)),this.updateButtonText()},select:function(e){e&&!t.isArray(e)&&(e=[e]);for(var i=0;i<e.length;i++){var s=e[i],n=t("option",this.$select).filter((function(){return t(this).val()==s})),l=t(".multiselect-container li input",this.$container).filter((function(){return t(this).val()==s}));this.options.selectedClass&&l.parents("li").addClass(this.options.selectedClass),l.prop("checked",!0),n.attr("selected","selected").prop("selected",!0),this.options.onChange(n,!0)}this.updateButtonText()},deselect:function(e){e&&!t.isArray(e)&&(e=[e]);for(var i=0;i<e.length;i++){var s=e[i],n=t("option",this.$select).filter((function(){return t(this).val()==s})),l=t(".multiselect-container li input",this.$container).filter((function(){return t(this).val()==s}));this.options.selectedClass&&l.parents("li").removeClass(this.options.selectedClass),l.prop("checked",!1),n.removeAttr("selected").prop("selected",!1),this.options.onChange(n,!1)}this.updateButtonText()},rebuild:function(){t(".multiselect-container",this.$container).html(""),this.buildSelectAll(),this.buildDropdown(),this.updateButtonText(),(this.options.enableFiltering||this.options.enableCaseInsensitiveFiltering)&&this.buildFilter()},dataprovider:function(t){var e="";t.forEach((function(t){e+='<option value="'+t.value+'">'+t.label+"</option>"})),this.$select.html(e),this.rebuild()},getOptions:function(e){return t.extend({},this.defaults,e)},updateButtonText:function(){var e=this.getSelected();t("button",this.$container).html(this.options.buttonText(e,this.$select)),t("button",this.$container).attr("title",this.options.buttonTitle(e,this.$select))},getSelected:function(){return t('option:selected[value!="'+this.options.selectAllValue+'"]',this.$select)},updateOriginalOptions:function(){this.originalOptions=this.$select.clone()[0].options},asyncFunction:function(t,e,i){var s=Array.prototype.slice.call(arguments,3);return setTimeout((function(){t.apply(i||window,s)}),e)}},t.fn.multiselect=function(i,s){return this.each((function(){var n=t(this).data("multiselect"),l="object"==typeof i&&i;n||t(this).data("multiselect",n=new e(this,l)),"string"==typeof i&&n[i](s)}))},t.fn.multiselect.Constructor=e,t((function(){t("select[data-role=multiselect]").multiselect()}))}(window.jQuery);