function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),XIVDBTooltipsClass=function(){function a(){_classCallCheck(this,a),this.version="0.7",this.hasInitialized=!1,this.tooltipsTimer=!1,this.tooltipsDelay=1e3,this.queue=null,this.queueDelay=1e3}return _createClass(a,[{key:"initialize",value:function(){var a=this;XIVDBTooltipsDevice.setOptions({mobileIgnore:this.options.mobileIgnore,mobileWidth:this.options.mobileWidth}),XIVDBTooltipsDevice.isOnMobile()||(this.validateTooltipOptions(),XIVDBTooltipsDependency.passed(function(){XIVDBTooltipsDevice.handleResponsive(),XIVDBTooltipsDOM.prepare(),a.hasInitialized=!0,a.get()}))}},{key:"getVersion",value:function(){return this.version}},{key:"setOptions",value:function(a){this.options=a,window.location.href.indexOf(this.xivdb)>-1&&(this.options.includeCredits=!1)}},{key:"getOption",value:function(a){return this.options[a]}},{key:"validateTooltipOptions",value:function(){for(var a in xivdb_tooltips_default)"undefined"==typeof this.options[a]&&(this.options[a]=xivdb_tooltips_default[a])}},{key:"get",value:function(){this.hasInitialized&&!XIVDBTooltipsDevice.isOnMobile()&&(clearTimeout(this.queue),this.queue=setTimeout(function(){XIVDBTooltipsUrls.parse(),(links=XIVDBTooltipsUrls.getLinks())&&XIVDBTooltipsQuery.get(links,function(a){XIVDBTooltipsDOM.inject(a),(CompletedEvent=XIVDBTooltips.getOption("event_tooltipsLoaded"))&&CompletedEvent()})},this.queueDelay))}},{key:"getDelayed",value:function(){clearTimeout(this.tooltipsTimer),this.tooltipsTimer=setTimeout(function(){XIVDBTooltips.get()},this.tooltipsDelay)}},{key:"hide",value:function(){XIVDBTooltipsDOM.hide()}}]),a}(),XIVDBTooltipsDependencyClass=function(){function a(){_classCallCheck(this,a),this.jquery="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js",this.fa="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css"}return _createClass(a,[{key:"passed",value:function(a){var b=this;return this.checkForJquery(),"undefined"==typeof $?setTimeout(function(){return"undefined"==typeof $?console.error("jquery could not be embedded, tooltips cannot run"):(b.checkForFontAwesome(),a())},500):a()}},{key:"checkForJquery",value:function(){if("undefined"==typeof $||!window.jQuery){var a=document.createElement("script");return a.type="text/javascript",a.src=this.jquery,document.getElementsByTagName("head")[0].appendChild(a),!0}return $?!0:!1}},{key:"checkForFontAwesome",value:function(){if(0==$('link[href="'+this.fa+'"]').length){var a=document.createElement("link");a.setAttribute("href",this.fa),a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),$("head")[0].appendChild(a)}}}]),a}(),XIVDBTooltipsDeviceClass=function(){function a(){_classCallCheck(this,a),this.onMobile=!1,this.mobileIgnore=xivdb_tooltips_default.mobileIgnore,this.mobileWidth=xivdb_tooltips_default.mobileWidth}return _createClass(a,[{key:"isOnMobile",value:function(){return this.onMobile}},{key:"setOptions",value:function(a){this.mobileIgnore=a.mobileIgnore,this.mobileWidth=a.mobileWidth}},{key:"handleResponsive",value:function(){var a=this;this.mobileIgnore||(this.onMobile=Math.max(document.documentElement.clientWidth,window.innerWidth||0)<=this.mobileWidth?!0:!1,$(window).resize(function(){a.onMobile=Math.max(document.documentElement.clientWidth,window.innerWidth||0)<=a.mobileWidth?!0:!1}))}}]),a}(),XIVDBTooltipsDOMClass=function(){function a(){_classCallCheck(this,a),this.isActive=!1}return _createClass(a,[{key:"prepare",value:function(){var a=this,b=XIVDBTooltips.getOption("xivdb"),c=XIVDBTooltips.getVersion();$("head").append('<link href="'+b+"/tooltips.css?v="+c+'" rel="stylesheet" type="text/css">'),$("body").append('<div class="xivdb" style="display:none;"></div>'),$("body").on("mouseenter","[data-xivdb-key]",function(b){a.isActive=!0;var c=$(b.currentTarget),d=c.attr("data-xivdb-key"),e=XIVDBTooltipsHolder.get(d);$(".ui-draggable-dragging").length>0||($(".xivdb").html(e),a.show(b))}).on("mouseleave","*[data-xivdb-key]",function(b){a.isActive=!1,$(b.target),a.hide()}),$("body").on("mousemove",function(b){a.isActive&&a.follow(b)}),XIVDBTooltips.getOption("preventHtmlHeight")||$("html").css({height:"100%"})}},{key:"hide",value:function(){$(".xivdb").hide().html("")}},{key:"show",value:function(a){this.follow(a),$(".xivdb").show()}},{key:"follow",value:function(a){var b=(XIVDBTooltips.getOption("linkContainer"),a.pageX+30),c=a.pageY+30,d=$(".xivdb").outerWidth(!0),e=$(".xivdb").outerHeight(!0),f=c+e,g=b+d,h=$(window).height()+$(window).scrollTop(),i=$(window).scrollLeft()+$(window).width();g>i&&(b=a.pageX-d),f>h&&(c=a.pageY-e),this.position(b,c)}},{key:"position",value:function(a,b){$(".xivdb").css({top:b+"px",left:a+"px"})}},{key:"inject",value:function(a){for(var b in a)for(var c in a[b]){var d=a[b][c],e=d.data,f=d.html,g="xivdb_"+b+"_"+e.id,h=XIVDBTooltips.getOption("linkContainer"),i=$(h+' [data-xivdb-key="'+g+'"]');if(XIVDBTooltipsHolder.add(g,f),this.checkLinkSettings(i,["noreplace","seturlname","replacename"])&&i.text(e.name),this.checkLinkSettings(i,["noreplace","seturlcolor","colorname"])){var j=XIVDBTooltips.getOption("seturlcolorDarken")?"rarity-"+e.color+"-darken":"rarity-"+e.color;i.addClass(j)}if(this.checkLinkSettings(i,["noreplace","seturlicon","showicon"])){var j="xivdb-ii",k=XIVDBTooltips.getOption("iconSize");XIVDBTooltips.getOption("iconCircle")&&(j+=" xivdb-iir"),i.prepend('<img src="'+e.icon+'" class="'+j+'" height="'+k+'">')}}}},{key:"checkLinkSettings",value:function(a,b){for(var c in b){var d=b[c],e="data-xivdb-"+d;if(XIVDBTooltips.getOption(d)===!1)return!1;if("undefined"!=typeof a.attr(e)&&("0"==a.attr(e)||"false"==a.attr(e).toLowerCase()))return!1}return!0}},{key:"getFrame",value:function(){return $("<div></div>").html("")}}]),a}(),XIVDBTooltipsHolderClass=function(){function a(){_classCallCheck(this,a),this.tooltips={}}return _createClass(a,[{key:"add",value:function(a,b){this.tooltips[a]=b}},{key:"get",value:function(a){return this.tooltips[a]}},{key:"exists",value:function(a){return this.tooltips[a]?!0:!1}}]),a}(),XIVDBTooltipsUrlsClass=function(){function a(){_classCallCheck(this,a),this.links={}}return _createClass(a,[{key:"getLinks",value:function(){return this.links.length>0?this.links:!1}},{key:"parse",value:function(){this.links={};var a=XIVDBTooltips.getOption("linkContainer");$(a+" a, "+a+" *[data-tooltip-id]").each(function(a,b){var c=$(b),d=c.attr("href"),e=c.attr("data-tooltip-id");if(!e){if(c.attr("data-xivdb-ignore"))return;if("undefined"==typeof d||d.length<1)return}if(!c.attr("data-xivdb-tooltip")&&(XIVDBTooltips.getOption("includeHiddenLinks")||c.is(":visible"))){if(e)var e=e.split("/"),f=e[0],g=e[1];else{if(d=d.toString().toLowerCase().replace("//","/").replace("http:","").replace("https:","").toString(),"/"!=d[0]&&-1==d.indexOf(XIVDBTooltips.getOption("xivdb")))return;if(d=d.replace("xivdb.com",""),d=d.split("/").filter(function(a){return a.toString().length>0}),-1==xivdb_tooltips_valid_types.indexOf(d[0]))return;var f=d[0].replace("?",""),g=d[1];if(d.indexOf(".com/?")>-1&&(d=d.replace(".com/?",".com/"),c.attr("href",d.toString())),"undefined"==typeof d||d.length<2)return}var h="xivdb_"+f+"_"+g;return c.attr("data-xivdb-parent")&&!c.attr("data-xivdb-key")?c.parents(c.attr("data-xivdb-parent")).attr("data-xivdb-key",h):c.attr("data-xivdb-parent")?void 0:c.attr("data-xivdb-key",h)}}),this.links=$(XIVDBTooltips.getOption("includeHiddenLinks")?XIVDBTooltips.getOption("linkContainer")+" [data-xivdb-key]":XIVDBTooltips.getOption("linkContainer")+" [data-xivdb-key]:visible")}}]),a}(),XIVDBTooltipsQueryClass=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"get",value:function(a,b){if(!XIVDBTooltipsDevice.isOnMobile()){var c={};a.each(function(a,b){var d=$(b).attr("data-xivdb-key"),e=d.split("_"),f=e[1].toString(),g=parseInt(e[2]);XIVDBTooltipsHolder.exists(d)||0!=f.length&&g&&("undefined"==typeof c[f]&&(c[f]=[]),c[f].push(g))});for(var d in c)c[d]=c[d].join(",");Object.keys(c).length>0&&this.query(c,b)}}},{key:"query",value:function(a,b){XIVDBTooltipsDevice.isOnMobile()||$.ajax({url:XIVDBTooltips.getOption("xivdb")+"/tooltip",method:"POST",dataType:"json",cache:!1,data:{list:a,language:XIVDBTooltips.getOption("language")},success:function(a){return a?"object"!=typeof a?void console.error("Tooltips response was not an object"):void(b&&b(a)):void console.error("Tooltips returned no response")},error:function(a,b,c){console.error("----------------"),console.error("Error loading tooltips!"),console.error(a.responseText),console.error(b,c),console.error("----------------")}})}}]),a}(),xivdb_tooltips_default={xivdb:"http://xivdb.com",language:"en",jqueryEmbed:!0,fontAwsomeEmbed:!0,seturlname:!0,seturlcolor:!0,seturlcolorDarken:!0,seturlicon:!0,iconSize:18,iconCircle:!0,tooltipFixed:!1,tooltipFixedBottom:!1,targetBlank:!0,includeHiddenLinks:!0,includeCredits:!0,includeFrameShadow:!1,includeLocalLinks:!1,preventHtmlHeight:!1,container:window,linkContainer:"body",parentTooltipAttribute:"data-xivdb",parentTooltip:!0,watch:".search-content",watchDelay:750,mobileIgnore:!1,mobileWidth:720,event_tooltipsLoaded:null},xivdb_tooltips_valid_types=["item","achievement","action","gathering","instance","leve","enemy","emote","placename","status","title","recipe","quest","shop","npc","minion","mount","weather","fate"],XIVDBTooltips=new XIVDBTooltipsClass,XIVDBTooltipsDevice=new XIVDBTooltipsDeviceClass,XIVDBTooltipsUrls=new XIVDBTooltipsUrlsClass,XIVDBTooltipsQuery=new XIVDBTooltipsQueryClass,XIVDBTooltipsDependency=new XIVDBTooltipsDependencyClass,XIVDBTooltipsDOM=new XIVDBTooltipsDOMClass,XIVDBTooltipsHolder=new XIVDBTooltipsHolderClass;document.addEventListener("DOMContentLoaded",function(){XIVDBTooltips.setOptions("undefined"!=typeof xivdb_tooltips?xivdb_tooltips:xivdb_tooltips_default),XIVDBTooltips.initialize()});